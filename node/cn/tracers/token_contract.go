package tracers

import (
	"strings"

	"github.com/kaiachain/kaia/accounts/abi"
	"github.com/kaiachain/kaia/api"
	"github.com/kaiachain/kaia/common"
	"github.com/kaiachain/kaia/common/hexutil"
)

var (
	_jsondata = `
[
	{
		"inputs": [
			{
				"internalType": "bytes",
				"name": "data",
				"type": "bytes"
			}
		],
		"name": "_decodeBalance",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "pure",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes",
				"name": "data",
				"type": "bytes"
			}
		],
		"name": "_decodeBytes32",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "pure",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes",
				"name": "data",
				"type": "bytes"
			}
		],
		"name": "_decodeString",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "pure",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address[]",
				"name": "tokens",
				"type": "address[]"
			}
		],
		"name": "balance",
		"outputs": [
			{
				"internalType": "bool[]",
				"name": "",
				"type": "bool[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes",
				"name": "data",
				"type": "bytes"
			}
		],
		"name": "bytesToHexString",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "pure",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address[]",
				"name": "tokens",
				"type": "address[]"
			},
			{
				"internalType": "address[][]",
				"name": "users",
				"type": "address[][]"
			}
		],
		"name": "tokenBalance",
		"outputs": [
			{
				"internalType": "uint256[][]",
				"name": "",
				"type": "uint256[][]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address[]",
				"name": "tokens",
				"type": "address[]"
			}
		],
		"name": "tokenInfo",
		"outputs": [
			{
				"internalType": "string[]",
				"name": "names",
				"type": "string[]"
			},
			{
				"internalType": "string[]",
				"name": "symbols",
				"type": "string[]"
			},
			{
				"internalType": "uint256[]",
				"name": "decimals",
				"type": "uint256[]"
			},
			{
				"internalType": "bool[]",
				"name": "hasDecimals",
				"type": "bool[]"
			},
			{
				"internalType": "uint256[]",
				"name": "totalSupplies",
				"type": "uint256[]"
			},
			{
				"internalType": "bool[]",
				"name": "hasTotalSupply",
				"type": "bool[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]
`
	_deployCode          = "0x608060405234801561001057600080fd5b506004361061007d5760003560e01c80637d520c221161005b5780637d520c22146101175780639496146014610147578063cadda4ba14610177578063dfca5f24146101a75761007d565b80631a5d94c41461008257806328523bc3146100b25780636f28a812146100e2575b600080fd5b61009c60048036036100979190810190611882565b6101d7565b6040516100a99190611e05565b60405180910390f35b6100cc60048036036100c79190810190611816565b6101f3565b6040516100d99190611d14565b60405180910390f35b6100fc60048036036100f791908101906117d5565b61050c565b60405161010e96959493929190611d58565b60405180910390f35b610131600480360361012c9190810190611882565b610fe8565b60405161013e9190611e05565b60405180910390f35b610161600480360361015c9190810190611882565b611257565b60405161016e9190611e05565b60405180910390f35b610191600480360361018c91908101906117d5565b611274565b60405161019e9190611d36565b60405180910390f35b6101c160048036036101bc9190810190611882565b6113fb565b6040516101ce9190611e27565b60405180910390f35b60606000602083015190506101eb81611418565b915050919050565b606080835160405190808252806020026020018201604052801561022b57816020015b60608152602001906001900390816102165790505b50905060008090505b845181101561050157606084828151811061024b57fe5b60200260200101519050606081516040519080825280602002602001820160405280156102875781602001602082028038833980820191505090505b50905060008090505b82518110156104d957600060608986815181106102a957fe5b602002602001015173ffffffffffffffffffffffffffffffffffffffff168584815181106102d357fe5b60200260200101516040516024016102eb9190611cf9565b6040516020818303038152906040527f70a08231000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040516103759190611ce2565b600060405180830381855afa9150503d80600081146103b0576040519150601f19603f3d011682016040523d82523d6000602084013e6103b5565b606091505b509150915081156104af576000815114156103e95760008484815181106103d857fe5b6020026020010181815250506104aa565b3073ffffffffffffffffffffffffffffffffffffffff1663dfca5f24826040518263ffffffff1660e01b81526004016104229190611de3565b60206040518083038186803b15801561043a57600080fd5b505afa92505050801561046b57506040513d601f19601f820116820180604052506104689190810190611945565b60015b61048e57600084848151811061047d57fe5b6020026020010181815250506104a9565b8085858151811061049b57fe5b602002602001018181525050505b5b6104ca565b60008484815181106104bd57fe5b6020026020010181815250505b50508080600101915050610290565b50808484815181106104e757fe5b602002602001018190525050508080600101915050610234565b508091505092915050565b606080606080606080865160405190808252806020026020018201604052801561054a57816020015b60608152602001906001900390816105355790505b509550865160405190808252806020026020018201604052801561058257816020015b606081526020019060019003908161056d5790505b50945086516040519080825280602002602001820160405280156105b55781602001602082028038833980820191505090505b50935086516040519080825280602002602001820160405280156105e85781602001602082028038833980820191505090505b509250865160405190808252806020026020018201604052801561061b5781602001602082028038833980820191505090505b509150865160405190808252806020026020018201604052801561064e5781602001602082028038833980820191505090505b5090506000606060008090505b8951811015610fca5760008a828151811061067257fe5b602002602001015190508073ffffffffffffffffffffffffffffffffffffffff166040516024016040516020818303038152906040527f06fdde03000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040516107239190611ce2565b600060405180830381855afa9150503d806000811461075e576040519150601f19603f3d011682016040523d82523d6000602084013e610763565b606091505b5080945081955050508315610922576000835114156107a857604051806020016040528060008152508a838151811061079857fe5b602002602001018190525061091d565b3073ffffffffffffffffffffffffffffffffffffffff166394961460846040518263ffffffff1660e01b81526004016107e19190611de3565b60006040518083038186803b1580156107f957600080fd5b505afa92505050801561082f57506040513d6000823e3d601f19601f8201168201806040525061082c9190810190611904565b60015b610902573073ffffffffffffffffffffffffffffffffffffffff16631a5d94c4846040518263ffffffff1660e01b815260040161086c9190611de3565b60006040518083038186803b15801561088457600080fd5b505afa9250505080156108ba57506040513d6000823e3d601f19601f820116820180604052506108b79190810190611904565b60015b6108e3576108c783610fe8565b8a83815181106108d357fe5b60200260200101819052506108fd565b808b84815181106108f057fe5b6020026020010181905250505b61091c565b808b848151811061090f57fe5b6020026020010181905250505b5b610970565b6040518060400160405280600c81526020017f63657274696b2d66616c736500000000000000000000000000000000000000008152508a838151811061096457fe5b60200260200101819052505b8073ffffffffffffffffffffffffffffffffffffffff166040516024016040516020818303038152906040527f95d89b41000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff8381831617835250505050604051610a179190611ce2565b600060405180830381855afa9150503d8060008114610a52576040519150601f19603f3d011682016040523d82523d6000602084013e610a57565b606091505b5080945081955050508315610c1657600083511415610a9c5760405180602001604052806000815250898381518110610a8c57fe5b6020026020010181905250610c11565b3073ffffffffffffffffffffffffffffffffffffffff166394961460846040518263ffffffff1660e01b8152600401610ad59190611de3565b60006040518083038186803b158015610aed57600080fd5b505afa925050508015610b2357506040513d6000823e3d601f19601f82011682018060405250610b209190810190611904565b60015b610bf6573073ffffffffffffffffffffffffffffffffffffffff16631a5d94c4846040518263ffffffff1660e01b8152600401610b609190611de3565b60006040518083038186803b158015610b7857600080fd5b505afa925050508015610bae57506040513d6000823e3d601f19601f82011682018060405250610bab9190810190611904565b60015b610bd757610bbb83610fe8565b898381518110610bc757fe5b6020026020010181905250610bf1565b808a8481518110610be457fe5b6020026020010181905250505b610c10565b808a8481518110610c0357fe5b6020026020010181905250505b5b610c64565b6040518060400160405280600c81526020017f63657274696b2d66616c73650000000000000000000000000000000000000000815250898381518110610c5857fe5b60200260200101819052505b8073ffffffffffffffffffffffffffffffffffffffff166040516024016040516020818303038152906040527f313ce567000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff8381831617835250505050604051610d0b9190611ce2565b600060405180830381855afa9150503d8060008114610d46576040519150601f19603f3d011682016040523d82523d6000602084013e610d4b565b606091505b5080945081955050508315610dd5576001878381518110610d6857fe5b602002602001019015159081151581525050600083511415610da3576000888381518110610d9257fe5b602002602001018181525050610dd0565b82806020019051610db79190810190611945565b888381518110610dc357fe5b6020026020010181815250505b610e10565b6000878381518110610de357fe5b6020026020010190151590811515815250506000888381518110610e0357fe5b6020026020010181815250505b8073ffffffffffffffffffffffffffffffffffffffff166040516024016040516020818303038152906040527f18160ddd000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff8381831617835250505050604051610eb79190611ce2565b600060405180830381855afa9150503d8060008114610ef2576040519150601f19603f3d011682016040523d82523d6000602084013e610ef7565b606091505b5080945081955050508315610f81576001858381518110610f1457fe5b602002602001019015159081151581525050600083511415610f4f576000868381518110610f3e57fe5b602002602001018181525050610f7c565b82806020019051610f639190810190611945565b868381518110610f6f57fe5b6020026020010181815250505b610fbc565b6000858381518110610f8f57fe5b6020026020010190151590811515815250506000868381518110610faf57fe5b6020026020010181815250505b50808060010191505061065b565b50878787878787975097509750975097509750505091939550919395565b6060806040518060400160405280601081526020017f30313233343536373839616263646566000000000000000000000000000000008152509050606060028451026002016040519080825280601f01601f19166020018201604052801561105f5781602001600182028038833980820191505090505b5090507f30000000000000000000000000000000000000000000000000000000000000008160008151811061109057fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053507f7800000000000000000000000000000000000000000000000000000000000000816001815181106110ed57fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a90535060008090505b845181101561124c5782600486838151811061113a57fe5b602001015160f81c60f81b7effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916901c60f81c60ff168151811061117957fe5b602001015160f81c60f81b82600283026002018151811061119657fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a90535082600f60f81b8683815181106111d757fe5b602001015160f81c60f81b1660f81c60ff16815181106111f357fe5b602001015160f81c60f81b82600283026003018151811061121057fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508080600101915050611122565b508092505050919050565b60608180602001905161126d91908101906118c3565b9050919050565b60608082516040519080825280602002602001820160405280156112a75781602001602082028038833980820191505090505b50905060008090505b83518110156113f15760008482815181106112c757fe5b602002602001015173ffffffffffffffffffffffffffffffffffffffff16306040516024016112f69190611cf9565b6040516020818303038152906040527f70a08231000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040516113809190611ce2565b600060405180830381855afa9150503d80600081146113bb576040519150601f19603f3d011682016040523d82523d6000602084013e6113c0565b606091505b50509050808383815181106113d157fe5b6020026020010190151590811515815250505080806001019150506112b0565b5080915050919050565b6000818060200190516114119190810190611945565b9050919050565b606060008090505b60208160ff1610801561146b5750600060f81b838260ff166020811061144257fe5b1a60f81b7effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff191614155b1561147d578080600101915050611420565b60608160ff166040519080825280601f01601f1916602001820160405280156114b55781602001600182028038833980820191505090505b50905060008090505b8260ff168160ff16101561152a57848160ff16602081106114db57fe5b1a60f81b828260ff16815181106114ee57fe5b60200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a90535080806001019150506114be565b508092505050919050565b60008135905061154481612182565b92915050565b600082601f83011261155b57600080fd5b813561156e61156982611e6f565b611e42565b9150818183526020840193506020810190508385602084028201111561159357600080fd5b60005b838110156115c357816115a98882611535565b845260208401935060208301925050600181019050611596565b5050505092915050565b600082601f8301126115de57600080fd5b81356115f16115ec82611e97565b611e42565b9150818183526020840193506020810190508385602084028201111561161657600080fd5b60005b83811015611646578161162c8882611535565b845260208401935060208301925050600181019050611619565b5050505092915050565b600082601f83011261166157600080fd5b813561167461166f82611ebf565b611e42565b9150818183526020840193506020810190508360005b838110156116ba57813586016116a0888261154a565b84526020840193506020830192505060018101905061168a565b5050505092915050565b600082601f8301126116d557600080fd5b81356116e86116e382611ee7565b611e42565b9150808252602083016020830185838301111561170457600080fd5b61170f83828461212f565b50505092915050565b600082601f83011261172957600080fd5b815161173c61173782611f13565b611e42565b9150808252602083016020830185838301111561175857600080fd5b61176383828461213e565b50505092915050565b600082601f83011261177d57600080fd5b815161179061178b82611f3f565b611e42565b915080825260208301602083018583830111156117ac57600080fd5b6117b783828461213e565b50505092915050565b6000815190506117cf81612199565b92915050565b6000602082840312156117e757600080fd5b600082013567ffffffffffffffff81111561180157600080fd5b61180d848285016115cd565b91505092915050565b6000806040838503121561182957600080fd5b600083013567ffffffffffffffff81111561184357600080fd5b61184f858286016115cd565b925050602083013567ffffffffffffffff81111561186c57600080fd5b61187885828601611650565b9150509250929050565b60006020828403121561189457600080fd5b600082013567ffffffffffffffff8111156118ae57600080fd5b6118ba848285016116c4565b91505092915050565b6000602082840312156118d557600080fd5b600082015167ffffffffffffffff8111156118ef57600080fd5b6118fb84828501611718565b91505092915050565b60006020828403121561191657600080fd5b600082015167ffffffffffffffff81111561193057600080fd5b61193c8482850161176c565b91505092915050565b60006020828403121561195757600080fd5b6000611965848285016117c0565b91505092915050565b600061197a8383611b7b565b905092915050565b600061198e8383611bd9565b60208301905092915050565b60006119a68383611c8b565b905092915050565b60006119ba8383611cc4565b60208301905092915050565b6119cf816120e7565b82525050565b60006119e082611fbb565b6119ea8185612054565b9350836020820285016119fc85611f6b565b8060005b85811015611a385784840389528151611a19858261196e565b9450611a2483612013565b925060208a01995050600181019050611a00565b50829750879550505050505092915050565b6000611a5582611fc6565b611a5f8185612065565b9350611a6a83611f7b565b8060005b83811015611a9b578151611a828882611982565b9750611a8d83612020565b925050600181019050611a6e565b5085935050505092915050565b6000611ab382611fd1565b611abd8185612076565b935083602082028501611acf85611f8b565b8060005b85811015611b0b5784840389528151611aec858261199a565b9450611af78361202d565b925060208a01995050600181019050611ad3565b50829750879550505050505092915050565b6000611b2882611fe7565b611b328185612098565b9350611b3d83611fab565b8060005b83811015611b6e578151611b5588826119ae565b9750611b6083612047565b925050600181019050611b41565b5085935050505092915050565b6000611b8682611fdc565b611b908185612087565b9350611b9b83611f9b565b8060005b83811015611bcc578151611bb388826119ae565b9750611bbe8361203a565b925050600181019050611b9f565b5085935050505092915050565b611be2816120f9565b82525050565b6000611bf382611ff2565b611bfd81856120a9565b9350611c0d81856020860161213e565b611c1681612171565b840191505092915050565b6000611c2c82611ff2565b611c3681856120ba565b9350611c4681856020860161213e565b80840191505092915050565b6000611c5d82612008565b611c6781856120d6565b9350611c7781856020860161213e565b611c8081612171565b840191505092915050565b6000611c9682611ffd565b611ca081856120c5565b9350611cb081856020860161213e565b611cb981612171565b840191505092915050565b611ccd81612125565b82525050565b611cdc81612125565b82525050565b6000611cee8284611c21565b915081905092915050565b6000602082019050611d0e60008301846119c6565b92915050565b60006020820190508181036000830152611d2e81846119d5565b905092915050565b60006020820190508181036000830152611d508184611a4a565b905092915050565b600060c0820190508181036000830152611d728189611aa8565b90508181036020830152611d868188611aa8565b90508181036040830152611d9a8187611b1d565b90508181036060830152611dae8186611a4a565b90508181036080830152611dc28185611b1d565b905081810360a0830152611dd68184611a4a565b9050979650505050505050565b60006020820190508181036000830152611dfd8184611be8565b905092915050565b60006020820190508181036000830152611e1f8184611c52565b905092915050565b6000602082019050611e3c6000830184611cd3565b92915050565b6000604051905081810181811067ffffffffffffffff82111715611e6557600080fd5b8060405250919050565b600067ffffffffffffffff821115611e8657600080fd5b602082029050602081019050919050565b600067ffffffffffffffff821115611eae57600080fd5b602082029050602081019050919050565b600067ffffffffffffffff821115611ed657600080fd5b602082029050602081019050919050565b600067ffffffffffffffff821115611efe57600080fd5b601f19601f8301169050602081019050919050565b600067ffffffffffffffff821115611f2a57600080fd5b601f19601f8301169050602081019050919050565b600067ffffffffffffffff821115611f5657600080fd5b601f19601f8301169050602081019050919050565b6000819050602082019050919050565b6000819050602082019050919050565b6000819050602082019050919050565b6000819050602082019050919050565b6000819050602082019050919050565b600081519050919050565b600081519050919050565b600081519050919050565b600081519050919050565b600081519050919050565b600081519050919050565b600081519050919050565b600081519050919050565b6000602082019050919050565b6000602082019050919050565b6000602082019050919050565b6000602082019050919050565b6000602082019050919050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600081905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b60006120f282612105565b9050919050565b60008115159050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b82818337600083830152505050565b60005b8381101561215c578082015181840152602081019050612141565b8381111561216b576000848401525b50505050565b6000601f19601f8301169050919050565b61218b816120e7565b811461219657600080fd5b50565b6121a281612125565b81146121ad57600080fd5b5056fea2646970667358221220d104d135cbdaf94ec807188b68b61b3702d60a80ba73ca0d7adc4c71d46fdcf864736f6c63430006000033"
	TokenContractCaller  = common.HexToAddress("0x1992111111111111111111111111111111111110")
	TokenContractAddress = common.HexToAddress("0x1992111111111111111111111111111111111111")
)

type TokenContract struct {
	caller  common.Address
	address common.Address
	code    []byte
	abi     abi.ABI
}

func NewTokenContract() TokenContract {
	_abi, _ := abi.JSON(strings.NewReader(_jsondata))
	return TokenContract{
		caller:  TokenContractCaller,
		address: TokenContractAddress,
		code:    hexutil.MustDecode(_deployCode),
		abi:     _abi,
	}
}

func (tc *TokenContract) Override() *api.EthStateOverride {
	return &api.EthStateOverride{
		tc.address: api.EthOverrideAccount{
			Nonce:     nil,
			Code:      (*hexutil.Bytes)(&tc.code),
			Balance:   nil,
			State:     nil,
			StateDiff: nil,
		},
	}
}
